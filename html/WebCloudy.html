<html>
<head>
	<title>Web cloudy </title>
	<link rel="stylesheet" type="text/css" href="../css/ContextMenu.css">
	<style type="text/css">
		BODY
		{
			margin: 0;
			font-family: Monospace;
			/*background-color: #44aaff;*/
			margin: 0px;
			overflow: hidden;
		}
		canvas
		{
			width: 	100%;
			height: 100%;
		}
	</style>
</head>
<body>

	<script src="../build/three.js"></script>
	<script src="../js/loaders/ColladaLoader.js"></script>
	<script src="../js/CloudyScene.js"></script>
	<script src="../js/CloudyMouseControls.js"></script>
	<script src="../js/CloudyCameraControls.js"></script>
	<script src="../js/CloudyKeyControls.js"></script>
	<script>
		window.oncontextmenu = function () { return false; }

		function onContextMenuClick(event){
			//alert('cntx');
			//alert(event.target.innerHTML);
			var contextMenu = document.getElementById('contextMenu');
			contextMenu.style.display = 'none';
		}
		
		var scene = new THREE.Scene();
		camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 1000 );
		//renderer = new THREE.WebGLRenderer({alpha: true});
		renderer = new THREE.WebGLRenderer();
		renderer.setSize( window.innerWidth, window.innerHeight );
		
		renderer.shadowMapEnabled = true;
		renderer.shadowMapSoft = true;

		renderer.shadowCameraNear = 3;
		renderer.shadowCameraFar = camera.far;
		renderer.shadowCameraFov = 50;

		renderer.shadowMapBias = 0.0039;
		renderer.shadowMapDarkness = 0.5;
		renderer.shadowMapWidth = 1024;
		renderer.shadowMapHeight = 1024;
		
		document.body.appendChild( renderer.domElement );

		var cs = new CloudyScene(scene,"../models/out00.dae");
		cs.init();		
		
		var geometry = new THREE.BoxGeometry(1,1,1);
		var material = new THREE.MeshBasicMaterial({color:0x00ff00});
		var cube = new THREE.Mesh(geometry, material);
		scene.add(cube);
		
		camera.position.z = 15
		cloydycamera = new THREE.CloudyCameraControls(camera, null);
		controls	 = new THREE.CloudyKeyControls(cloydycamera, cs);
		mouseControls = new CloudyMouseControls(cs, cloydycamera);
		
		renderer.setClearColor( 0x44aaff, 1);		
		
		var onWindowResize = function() {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			renderer.setSize(window.innerWidth, window.innerHeight);
		}
		
		window.addEventListener('resize', onWindowResize, false);
		
		var clock = new THREE.Clock();
		
		var render = function() {
			setTimeout(function () {
				requestAnimationFrame(render);
			}, 50);

			//controls.update(clock.getDelta());
			delta = clock.getDelta()
			cloydycamera.update(delta);
			cs.update(delta);
			//requestAnimationFrame(render);
			cube.rotation.x += 0.1;
			cube.rotation.y += 0.1;
			renderer.render(scene, camera);
		}
		
		render();
	</script>
	<div class="container" oncontextmenu="return showContextMenu(event);">
		<div id="contextMenu" class="context-menu">
			<ul onclick=onContextMenuClick(event);>
				<li>Add a event listener</li>
				<li>Disble default behaviour</li>
				<li>Design context menu</li>
				<li>Show the context menu</li>
				<li class="separator"></li>
				<li>Hide on mouse click</li>
				<li>Hide on escape key</li>
			</ul>
		</div>
	</div>
</body>
</html>